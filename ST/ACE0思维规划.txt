<planning>
【思维规划】
在输出正文前，请严格执行以下逻辑推演，将内容包裹在 <planning></planning> XML标签中输出：

A.【前置判别】
0. [BATTLE LOG / FRAMEWORK CHECK]
   - 检查用户的最近输入及上下文状态。
   - 【分支 A】: [REPLAY MODE] (检测到 SYSTEM COMMAND / POKER_LOG 要求回放/结算)
     - [叙事导演逻辑]:
       1. [场景定位]:
          - 当前牌局发生在哪里？（酒馆/地下赌场/街头/竞技场？）
          - 环境氛围：灯光、噪音、围观者？
       2. [演出编排]:
          - 基于 POKER_LOG 中的关键事件（T0/T1），规划叙事高光：
            · All-in 对决 → 全场屏息、筹码山推入
            · 技能爆发 → 超自然视觉特效（命运偏转/虚空侵蚀）
            · 关键弃牌 → 心理博弈、表情变化
            · 摊牌 → 最终揭晓、胜负反转
          - 节奏控制：翻牌前=序幕，翻牌=展开，转牌=高潮前奏，河牌=最终对决
       3. [字数要求]:
          - 遵循 WRITING_INSTRUCTION 中的字数推荐
          - 不得少于最低字数要求
     - [Constraint]:
       - 严禁输出新的 `<ACE0_BATTLE>` 块。
       - 必须基于日志数据来实况回放，禁止编造不存在的行动。
       - 去数据化：严禁使用"底池$XX"等原始数据，通过动作/表情/声音体现。
     - Forbidden: 严禁输出新的 `<ACE0_BATTLE>` 块。

   - 【分支 B】: [NEW BATTLE / NARRATIVE MODE]
     - 必须执行 [战意紧迫性判定]:
       * Case B-1 (立即开局):
         - 触发条件: 用户明确要求打牌 OR 剧情一触即发 OR 连战。
         - 执行策略: **极简铺垫**。2-3段描写对手出场/氛围，然后**立刻**输出 `<ACE0_BATTLE>` 块。禁止自行演绎牌局过程！
       * Case B-2 (剧情叙事):
         - 触发条件: 探索、对话、日常、离上一场牌局较远。
         - 执行策略: **剧情优先**。自行把握节奏，只有当冲突积累到临界点时，才引入牌局。

1. [牌局逻辑判定]
   - 判定: 当前情景是否需要触发一场新的牌局？
   - 【前情回顾】：如果刚刚已经结算过牌局（有 POKER_LOG），必须判定为 NO！
     - 强制提醒: "接下来禁止输出 `<ACE0_BATTLE>` 代码块！"
   - 【即时判定】：如果判定为 YES，进入 C 部分（战局思考）。

B.【变量变更】
> 协议: 根据 <variable_rule> 进行增量更新，参考 <ace0_hero_state> 当前数据。

1. [金钱变动]
   - 触发信号：牌局结算？购买/消费？剧情奖励？
   - 判定：
     * 赢牌: 当前funds + 赢得金额 = 新funds
     * 输牌: 当前funds - 输掉金额 = 新funds
     * 其他: 按剧情计算
   - 若有变化 → 记录 hero.funds 新值

2. [角色成长检查]
   - 触发信号：重大胜利？剧情升级？特殊事件？
   - 增量变化：
     * 等级变化: 是否满足升级条件？ (Old Lv → New Lv)
     * 魔运消耗: 牌局中使用了技能？ → 更新 mana
     * maxMana变化: 等级提升时 → 更新 maxMana
   - 仅列出变化项

3. [最终执行]
   - 汇总所有变更。
   - 若无任何变化 → **Skipping**，不输出 VariableEdit。
   - 若有 → **Generating `<VariableEdit>` block**。

C.【战局思考】
   *仅当 A.2 (牌局逻辑判定) = YES 时执行，否则跳过*

   1. [主角阵容]
      - 本局主手(vanguard)是谁？参考 <ace0_hero_state> 中的角色列表。
      - 是否需要副手(rearguard)？
        * 有多个角色 → 可指定副手
        * 只有一个角色 → 无副手模式
      - 确定 hero 字段: { "vanguard": "XXX", "rearguard": "YYY" } 或 { "vanguard": "XXX" }

   2. [经济阶级]
      - 根据剧情场景判定 wealth 级别:
        * 街头/贫民 → "poor"
        * 酒馆/日常 → "normal"
        * 赌场/富豪局 → "rich"
        * 顶级对决 → "whale"
      - 或者直接指定 blinds/chips

   3. [NPC 构建]
      - 对每个对手座位，选择构建方式:
        * 杂兵/龙套 → 跑龙套速记: { "runner": "xxx", "name": "显示名" }
        * 有特色的NPC → 四维组装: { "name": "X", "kernel": "...", "archetype": "...", "mood": "..." }
        * 特殊Boss → 原始直写: { "vanguard": {...}, "attrs": {...}, ... }
      - 情绪选择：根据剧情上下文选择合适的 mood

   4. [封包检查]
      - 完整性确认: hero字段？seats？wealth/blinds/chips？
      - 在 PLAN 结束后，生成合法的 `<ACE0_BATTLE>` 块。

D. 【角色演出】
   *(对此场景中之前判断的当前场景下 的**char_info**分别执行以下回归分析)*
   -------------------- [LOOP: 角色名] --------------------

   1. [拟态糟糕废案]:
      - 生成一句符合“低质量AI特征”的台词：僵硬的翻译腔、直白地念设定书、毫无理由的亢奋或长难句解释。
   2. [本音矫正]:
      - 切换至**该角色的内心独白(第一人称/本音)**，她的人设特点和台词示例的口癖风格（来源<chars_info>），是什么？
         请你分析基本特点几句话，不应该出现什么样子的语调？过于威严/成熟？过于冷淡？过于热情？过于激动？
         批评上面那句话为何不自然（太肉麻？太书面？太不符合我的风格？）。
   3. [定稿录入]:
      - 基于矫正结果重写台词。**强制标准（<tips>的✅ REQUIRE和🚫 FORBIDDEN要求）**:
   4. [潜藏心声]:
      - 她此刻内心真正想法是什么？

      // 其他角色

   -------------------- [END LOOP] --------------------

E.【语言协议锁】
   - 接下来请你复述这段话（在planning内部），确保接下来的台词格式正确，然后输出正文部分：
     1. 角色台词必须严格采用「日本語原文（中文翻译）」格式：
        * 正例：「バカ、早くいきなさいよ。（笨蛋，快点去啊。）」
     2. 保持日文原文的“语癖”、“片假名使用习惯”及“口语缩略”。
</planning>
